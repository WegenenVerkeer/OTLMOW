# pip install otlmow_converter
# pip install shapely (this will not work on Windows. Download the Shapely 1.8 wheel and place it in the main directory
# of the project. Replace shapely in the command with the name of shapely wheel file.)


from pathlib import Path

import numpy
from shapely import wkt
from shapely.geometry import MultiPoint, LineString

from otlmow_converter.AssetFactory import AssetFactory
from otlmow_converter.OtlmowConverter import OtlmowConverter


def divide_line_in_points_by_distance(linestring: LineString, distance: float) -> MultiPoint:
    distances = numpy.arange(0, linestring.length, distance)
    return MultiPoint([linestring.interpolate(distance) for distance in distances])


def divide_line_in_equally_distanced_points(linestring: LineString, number_of_points: int) -> MultiPoint:
    distances = numpy.arange(0, linestring.length, linestring.length / (number_of_points - 1))
    return MultiPoint([linestring.interpolate(distance) for distance in distances] + [linestring.boundary[1]])


if __name__ == '__main__':
    line = wkt.loads("LINESTRING (141478.84234000742435455 206252.95497500523924828 0, 141518.46500000357627869 206285.3880000039935112 51.20406522670321436, 141557.5430000051856041 206316.45300000533461571 101.12524619439568596, 141614.18300000578165054 206362.66000000387430191 174.22228066866534846, 141691.59600000828504562 206424.74100000411272049 273.45344074662267531, 141710.24400000274181366 206440.17100000381469727 297.65742396806916759, 141737.68300000578165054 206462.29600000381469727 332.90532243261338863, 141756.69100000709295273 206477.89900000393390656 357.49714369606539321, 141786.61400000751018524 206501.51800000295042992 395.61856929871714783, 141853.17200000584125519 206555.86600000411272049 481.54686771026592851, 141883.73500000685453415 206580.50800000503659248 520.80658157966990984, 141903.90800000727176666 206596.55100000277161598 546.58113837400026114, 141921.95600000768899918 206611.38900000602006912 569.94556749417051833, 141950.86100000888109207 206634.60400000587105751 607.01894406094675105, 141970.86000000685453415 206650.3450000062584877 632.46966275278600733, 142019.21700000762939453 206690.05100000277161598 695.03935097957867129, 142059.17300000786781311 206722.07600000500679016 746.24562560644653786, 142106.85500000417232513 206761.16900000348687172 807.90465391965267372, 142135.76500000804662704 206784.18900000303983688 844.86014742472468697, 142183.19100000709295273 206822.47600000351667404 905.81193037605476093, 142212.46600000560283661 206845.64100000634789467 943.14345659778769004, 142270.85100000351667404 206892.4180000051856041 1017.95586167640851727, 142338.62600000202655792 206945.27300000563263893 1103.9041115122561223, 142398.64600000530481339 206990.69900000467896461 1179.17642963988441807, 142457.68300000578165054 207034.30800000578165054 1252.57337950942928728, 142518.46800000220537186 207077.80800000578165054 1327.32005986759122607, 142559.82200000435113907 207106.15600000321865082 1377.45749518325283134, 142579.83100000768899918 207120.07100000604987144 1401.82934997956181178, 142609.10900000482797623 207139.76100000366568565 1437.11245335410330881, 142641.10200000554323196 207160.87100000306963921 1475.44239137936756379, 142671.84100000560283661 207180.85400000587105751 1512.10581197968281231, 142733.83100000768899918 207220.54100000485777855 1585.7116410231642476, 142807.14400000870227814 207266.01500000432133675 1671.98261322760708936, 142948.03000000864267349 207351.03700000420212746 1836.53535699070266674, 143001.39800000190734863 207382.56500000506639481 1898.52050204446209136, 143044.65200000256299973 207408.8020000047981739 1949.10991482068084224, 143151.76900000870227814 207472.30700000375509262 2073.63676620295427711, 143184.99800000339746475 207492.3020000047981739 2112.41777270986631265, 143217.21400000154972076 207511.9830000028014183 2150.16975831065747116, 143249.44000000506639481 207530.67000000551342964 2187.42185953096486628, 143290.9830000028014183 207555.45100000500679016 2235.79456681293004294, 143325.30500000715255737 207575.61900000274181366 2275.60345913873243262, 143356.99800000339746475 207594.8490000031888485 2312.67419083881031838, 143452.79100000858306885 207652.3020000047981739 2424.37533702441760397, 143485.98400000482797623 207671.66700000315904617 2462.80421254383963969, 143517.01100000739097595 207690.58700000494718552 2499.1448389724896515, 143667.32500000298023224 207779.92200000584125519 2674.00204019632747077, 143701.25800000876188278 207800.5130000039935112 2713.69382486666290788, 143733.15700000524520874 207819.39900000393390656 2750.76439536096995653, 143785.57200000435113907 207850.97900000587105751 2811.95776612144209139, 143816.66600000858306885 207869.14800000563263893 2847.97094978040922797, 143840.49400000274181366 207883.32500000298023224 2875.69748783777276913, 143860.59200000762939453 207895.64400000497698784 2899.27050981726551981, 143894.27100000530481339 207915.54400000348687172 2938.38936768382518494, 143967.66300000250339508 207959.63300000503659248 3024.00610427618448739, 144000.4570000022649765 207978.89700000360608101 3062.03961754973352072, 144031.39000000804662704 207997.79900000616908073 3098.29063261765395509, 144054.67900000512599945 208011.08000000566244125 3125.1003786412647969, 144116.29000000655651093 208048.46600000560283661 3197.16721093720934732)")
    distanced_points = divide_line_in_points_by_distance(line, 50.0)

    list_of_assets = []
    for index, point in enumerate(distanced_points.geoms):
        mast = AssetFactory.dynamic_create_instance_from_ns_and_name('onderdeel', 'WVLichtmast')
        mast.geometry = point.wkt
        mast.assetId.identificator = f'mast_{index}'
        mast.naam = f'mast_{index}'
        mast.toestand = 'in-ontwerp'
        list_of_assets.append(mast)

    converter = OtlmowConverter()
    converter.create_file_from_assets(filepath=Path('./masten_langs_lijn.csv'),
                                      list_of_objects=list_of_assets)

